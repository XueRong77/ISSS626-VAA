<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Xuerong">

<title>Take-home_Ex01</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Take-home_Ex01_files/libs/clipboard/clipboard.min.js"></script>
<script src="Take-home_Ex01_files/libs/quarto-html/quarto.js"></script>
<script src="Take-home_Ex01_files/libs/quarto-html/popper.min.js"></script>
<script src="Take-home_Ex01_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Take-home_Ex01_files/libs/quarto-html/anchor.min.js"></script>
<link href="Take-home_Ex01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Take-home_Ex01_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Take-home_Ex01_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Take-home_Ex01_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Take-home_Ex01_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="../../styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#install-necessary-packages" id="toc-install-necessary-packages" class="nav-link active" data-scroll-target="#install-necessary-packages"><strong>Install Necessary Packages</strong></a>
  <ul class="collapse">
  <li><a href="#setup-and-loading-packages" id="toc-setup-and-loading-packages" class="nav-link" data-scroll-target="#setup-and-loading-packages">1. Setup and Loading Packages</a></li>
  <li><a href="#data-import-and-wrangling" id="toc-data-import-and-wrangling" class="nav-link" data-scroll-target="#data-import-and-wrangling">2. Data Import and Wrangling</a>
  <ul class="collapse">
  <li><a href="#import-road-accident-data" id="toc-import-road-accident-data" class="nav-link" data-scroll-target="#import-road-accident-data">Import Road Accident Data</a></li>
  <li><a href="#convert-to-spatial-data" id="toc-convert-to-spatial-data" class="nav-link" data-scroll-target="#convert-to-spatial-data">Convert to Spatial Data</a></li>
  <li><a href="#add-time-related-variables" id="toc-add-time-related-variables" class="nav-link" data-scroll-target="#add-time-related-variables">Add Time-Related Variables</a></li>
  </ul></li>
  <li><a href="#geospatial-analysis" id="toc-geospatial-analysis" class="nav-link" data-scroll-target="#geospatial-analysis">3. Geospatial Analysis</a>
  <ul class="collapse">
  <li><a href="#network-spatial-point-pattern-analysis" id="toc-network-spatial-point-pattern-analysis" class="nav-link" data-scroll-target="#network-spatial-point-pattern-analysis">Network Spatial Point Pattern Analysis</a></li>
  <li><a href="#kernel-density-estimation-kde" id="toc-kernel-density-estimation-kde" class="nav-link" data-scroll-target="#kernel-density-estimation-kde">Kernel Density Estimation (KDE)</a></li>
  </ul></li>
  <li><a href="#geovisualisation-and-geocommunication" id="toc-geovisualisation-and-geocommunication" class="nav-link" data-scroll-target="#geovisualisation-and-geocommunication">4. Geovisualisation and Geocommunication</a>
  <ul class="collapse">
  <li><a href="#accident-heatmap-and-road-network-overlay" id="toc-accident-heatmap-and-road-network-overlay" class="nav-link" data-scroll-target="#accident-heatmap-and-road-network-overlay"><strong>Accident Heatmap and Road Network Overlay</strong></a></li>
  <li><a href="#spatio-temporal-visualization-animation" id="toc-spatio-temporal-visualization-animation" class="nav-link" data-scroll-target="#spatio-temporal-visualization-animation">Spatio-Temporal Visualization (Animation)</a></li>
  <li><a href="#space-time-k-function-analysis" id="toc-space-time-k-function-analysis" class="nav-link" data-scroll-target="#space-time-k-function-analysis">Space-Time K-function Analysis</a></li>
  </ul></li>
  <li><a href="#bonus-predictive-modeling-machine-learning" id="toc-bonus-predictive-modeling-machine-learning" class="nav-link" data-scroll-target="#bonus-predictive-modeling-machine-learning">5. Bonus: Predictive Modeling (Machine Learning)</a>
  <ul class="collapse">
  <li><a href="#feature-preparation-for-machine-learning" id="toc-feature-preparation-for-machine-learning" class="nav-link" data-scroll-target="#feature-preparation-for-machine-learning">Feature Preparation for Machine Learning</a></li>
  <li><a href="#random-forest-model" id="toc-random-forest-model" class="nav-link" data-scroll-target="#random-forest-model">Random Forest Model</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home_Ex01</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Xuerong </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="install-necessary-packages" class="level1">
<h1><strong>Install Necessary Packages</strong></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sf"</span>, <span class="st">"tidyverse"</span>, <span class="st">"spatstat"</span>, <span class="st">"gganimate"</span>, <span class="st">"readr"</span>, <span class="st">"lubridate"</span>, <span class="st">"ggplot2"</span>, <span class="st">"spatstat.linnet"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> required_packages) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sf' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidyverse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.1
✔ purrr     1.0.2     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
Loading required package: spatstat

Loading required package: spatstat.data

Loading required package: spatstat.univar

spatstat.univar 3.0-1

Loading required package: spatstat.geom

spatstat.geom 3.3-3

Loading required package: spatstat.random

spatstat.random 3.3-2

Loading required package: spatstat.explore

Loading required package: nlme


Attaching package: 'nlme'


The following object is masked from 'package:dplyr':

    collapse


spatstat.explore 3.3-2

Loading required package: spatstat.model

Loading required package: rpart

spatstat.model 3.3-1

Loading required package: spatstat.linnet

spatstat.linnet 3.2-2


spatstat 3.1-1 
For an introduction to spatstat, type 'beginner' 


Loading required package: gganimate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'gganimate' was built under R version 4.2.3</code></pre>
</div>
</div>
<section id="setup-and-loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-loading-packages">1. Setup and Loading Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.linnet)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) <span class="co"># For potential machine learning bonus analysis</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lattice'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:spatstat.model':

    panel.histogram</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:spatstat.explore':

    panel.histogram</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'caret'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    lift</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep) <span class="co"># For advanced spatial statistics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'spdep' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>To access larger datasets in this package, install the spDataLarge
package with: `install.packages('spDataLarge',
repos='https://nowosad.github.io/drat/', type='source')`</code></pre>
</div>
</div>
</section>
<section id="data-import-and-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-import-and-wrangling">2. Data Import and Wrangling</h2>
<section id="import-road-accident-data" class="level3">
<h3 class="anchored" data-anchor-id="import-road-accident-data">Import Road Accident Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load road accident data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>accidents <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/sharon/OneDrive - Singapore Management University/ISSS626 Data/Take_home_Ex/Take_home_Ex01/data/thai_road_accident_2019_2022.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 81735 Columns: 18
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (10): province_th, province_en, agency, route, vehicle_type, presumed_c...
dbl   (6): acc_code, number_of_vehicles_involved, number_of_fatalities, numb...
dttm  (2): incident_datetime, report_datetime

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load road network data (assuming GeoJSON format)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"/Users/sharon/OneDrive - Singapore Management University/ISSS626 Data/Take_home_Ex/Take_home_Ex01/data/hotosm_tha_roads_lines_geojson.geojson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `hotosm_tha_roads_lines_geojson' from data source 
  `/Users/sharon/Library/CloudStorage/OneDrive-SingaporeManagementUniversity/ISSS626 Data/Take_home_Ex/Take_home_Ex01/data/hotosm_tha_roads_lines_geojson.geojson' 
  using driver `GeoJSON'
Simple feature collection with 2792361 features and 14 fields
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 97.34457 ymin: 5.643645 xmax: 105.6528 ymax: 20.47168
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter accidents for BMR and remove missing coordinates</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>bmr_regions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Bangkok"</span>, <span class="st">"Nonthaburi"</span>, <span class="st">"Pathum Thani"</span>, <span class="st">"Samut Prakan"</span>, <span class="st">"Nakhon Pathom"</span>, <span class="st">"Samut Sakhon"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>accidents_clean <span class="ot">&lt;-</span> accidents <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(longitude), <span class="sc">!</span><span class="fu">is.na</span>(latitude)) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">%in%</span> bmr_regions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="convert-to-spatial-data" class="level3">
<h3 class="anchored" data-anchor-id="convert-to-spatial-data">Convert to Spatial Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert accidents data to a spatial object with appropriate CRS (WGS84)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>accidents_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(accidents_clean, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-time-related-variables" class="level3">
<h3 class="anchored" data-anchor-id="add-time-related-variables">Add Time-Related Variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add derived variables: hour, day of the week, and season</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>accidents_sf <span class="ot">&lt;-</span> accidents_sf <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">incident_datetime =</span> <span class="fu">as.POSIXct</span>(incident_datetime, <span class="at">format=</span><span class="st">"%Y-%m-%d %H:%M:%S"</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour =</span> <span class="fu">hour</span>(incident_datetime),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">day_of_week =</span> <span class="fu">wday</span>(incident_datetime, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">month</span>(incident_datetime) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Winter"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">month</span>(incident_datetime) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Summer"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">month</span>(incident_datetime) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="st">"Rainy"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Autumn"</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>         ))</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new severity column based on fatalities and injuries</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>accidents_sf<span class="sc">$</span>severity <span class="ot">&lt;-</span> <span class="fu">with</span>(accidents_sf, <span class="fu">ifelse</span>(number_of_fatalities <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"High"</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(number_of_injuries <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Medium"</span>, <span class="st">"Low"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="geospatial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="geospatial-analysis">3. Geospatial Analysis</h2>
<section id="network-spatial-point-pattern-analysis" class="level3">
<h3 class="anchored" data-anchor-id="network-spatial-point-pattern-analysis">Network Spatial Point Pattern Analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject accidents data to UTM Zone 47N (EPSG: 32647)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>accidents_sf_projected <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(accidents_sf, <span class="at">crs =</span> <span class="dv">32647</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coordinates and bounding box for spatstat conversion</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(accidents_sf_projected)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a spatstat window (bounding box) from the reprojected coordinates</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>window <span class="ot">&lt;-</span> <span class="fu">owin</span>(<span class="fu">range</span>(coords[, <span class="dv">1</span>]), <span class="fu">range</span>(coords[, <span class="dv">2</span>]))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data to ppp format (spatstat point pattern object)</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>accidents_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> coords[, <span class="dv">1</span>], <span class="at">y =</span> coords[, <span class="dv">2</span>], <span class="at">window =</span> window)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the point pattern to confirm</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(accidents_ppp, <span class="at">main =</span> <span class="st">"Road Traffic Accidents in BMR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="kernel-density-estimation-kde" class="level3">
<h3 class="anchored" data-anchor-id="kernel-density-estimation-kde">Kernel Density Estimation (KDE)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Reproject the accidents data to UTM Zone 47N (EPSG: 32647)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>accidents_projected <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(accidents_sf, <span class="at">crs =</span> <span class="dv">32647</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Extract the coordinates and create a bounding window</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>accident_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(accidents_projected)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>accident_window <span class="ot">&lt;-</span> <span class="fu">owin</span>(<span class="at">xrange =</span> <span class="fu">range</span>(accident_coords[, <span class="dv">1</span>]), <span class="at">yrange =</span> <span class="fu">range</span>(accident_coords[, <span class="dv">2</span>]))</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Convert to ppp object</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>accidents_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> accident_coords[, <span class="dv">1</span>], <span class="at">y =</span> accident_coords[, <span class="dv">2</span>], <span class="at">window =</span> accident_window)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>accidents_ppp_unique <span class="ot">&lt;-</span> <span class="fu">unique.ppp</span>(accidents_ppp)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Verify the ppp object</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(accidents_ppp_unique)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  11480 points
Average intensity 1.076791e-06 points per square unit

Coordinates are given to 10 decimal places

Window: rectangle = [591277.5, 710166.1] x [1486845.7, 1576520.5] units
                    (118900 x 89670 units)
Window area = 10661300000 square units</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Kernel Density Estimation (KDE) map</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>accident_density <span class="ot">&lt;-</span> <span class="fu">density</span>(accidents_ppp_unique, <span class="at">sigma =</span> <span class="dv">1000</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the density map</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(accident_density, <span class="at">main=</span><span class="st">"Accident Density in BMR"</span>, <span class="at">col=</span><span class="fu">topo.colors</span>(<span class="dv">356</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Network Spatial Point Pattern Analysis</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>roads_projected <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(roads, <span class="at">crs =</span> <span class="dv">32647</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data to keep only rows where both 'name' and 'name.en' are not empty</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>roads_filtered <span class="ot">&lt;-</span> roads_projected <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">""</span>, name.en <span class="sc">!=</span> <span class="st">""</span>, <span class="sc">!</span><span class="fu">is.na</span>(name), <span class="sc">!</span><span class="fu">is.na</span>(name.en))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many records remain after filtering</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">nrow</span>(roads_filtered))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 71588</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)  <span class="co"># For st_cast and spatial operations</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sp' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lwgeom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lwgeom' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to liblwgeom 3.0.0beta1 r16016, GEOS 3.11.0, PROJ 9.1.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lwgeom'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:sf':

    st_perimeter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.geom)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.linnet)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(profvis)  <span class="co"># For profiling</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to process data in chunks for memory efficiency</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>process_chunk <span class="ot">&lt;-</span> <span class="cf">function</span>(start_index, end_index, roads_sp_simplified) {</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Processing chunk from"</span>, start_index, <span class="st">"to"</span>, end_index))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the line segments for the chunk</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  line_segments <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">slot</span>(roads_sp_simplified[start_index<span class="sc">:</span>end_index, ], <span class="st">"lines"</span>), <span class="cf">function</span>(line_obj) {</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(line_obj<span class="sc">@</span>Lines, <span class="cf">function</span>(single_line) {</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>      single_line<span class="sc">@</span>coords  <span class="co"># Extract coordinates</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine the coordinates</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  all_coords <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">unlist</span>(line_segments, <span class="at">recursive =</span> <span class="cn">FALSE</span>))</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  segments <span class="ot">&lt;-</span> <span class="fu">cbind</span>(all_coords[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(all_coords) <span class="sc">-</span> <span class="dv">1</span>), ], all_coords[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(all_coords), ])</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(segments)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Starting the process..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Starting the process...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Cast to LINESTRING</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Casting to LINESTRING..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Casting to LINESTRING...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>roads_linestring <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(roads_filtered, <span class="st">"LINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_cast.sf(roads_filtered, "LINESTRING"): repeating attributes for
all sub-geometries for which they may not be constant</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Casting successful."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Casting successful.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Subset the dataset (for testing smaller portions)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Subsetting the dataset for testing..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Subsetting the dataset for testing...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>roads_linestring_subset <span class="ot">&lt;-</span> roads_linestring[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, ]</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Subsetting successful."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Subsetting successful.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Ensure geometries are LINESTRING and remove empty geometries</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Removing non-LINESTRING and empty geometries..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Removing non-LINESTRING and empty geometries...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>roads_linestring_subset <span class="ot">&lt;-</span> roads_linestring_subset[<span class="fu">st_geometry_type</span>(roads_linestring_subset) <span class="sc">==</span> <span class="st">"LINESTRING"</span>, ]</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>roads_linestring_subset <span class="ot">&lt;-</span> roads_linestring_subset[<span class="sc">!</span><span class="fu">st_is_empty</span>(roads_linestring_subset), ]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Empty geometries removed."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Empty geometries removed.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Simplify the geometries using sf's st_simplify</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Simplifying geometries with sf's st_simplify..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Simplifying geometries with sf's st_simplify...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>roads_simplified <span class="ot">&lt;-</span> <span class="fu">st_simplify</span>(roads_linestring_subset, <span class="at">dTolerance =</span> <span class="dv">1000</span>)  <span class="co"># Adjust tolerance as needed</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Simplification successful."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Simplification successful.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Convert the simplified sf object to Spatial</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Converting simplified sf object to Spatial..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Converting simplified sf object to Spatial...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>roads_sp_simplified <span class="ot">&lt;-</span> <span class="fu">as</span>(roads_simplified, <span class="st">"Spatial"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Conversion to Spatial successful."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Conversion to Spatial successful.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Process data in chunks to manage memory usage</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Processing data in chunks..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing data in chunks...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>chunk_size <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Define chunk size based on memory capacity</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>num_chunks <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">nrow</span>(roads_sp_simplified) <span class="sc">/</span> chunk_size)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>all_segments <span class="ot">&lt;-</span> <span class="fu">list</span>()  <span class="co"># Initialize list to store results</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(roads_sp_simplified), <span class="at">by =</span> chunk_size)) {</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  end_index <span class="ot">&lt;-</span> <span class="fu">min</span>(i <span class="sc">+</span> chunk_size <span class="sc">-</span> <span class="dv">1</span>, <span class="fu">nrow</span>(roads_sp_simplified))</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Processing chunk"</span>, i, <span class="st">"to"</span>, end_index))</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  all_segments[[<span class="fu">length</span>(all_segments) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">process_chunk</span>(i, end_index, roads_sp_simplified)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk 1 to 100</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk from 1 to 100</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk 101 to 200</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk from 101 to 200</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk 201 to 300</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk from 201 to 300</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk 301 to 400</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk from 301 to 400</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk 401 to 500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Processing chunk from 401 to 500</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all segments after processing</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Combining segments..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Combining segments...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>final_segments <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_segments)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 7: Define the spatial window</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Defining spatial window..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Defining spatial window...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>window <span class="ot">&lt;-</span> <span class="fu">owin</span>(<span class="at">xrange =</span> <span class="fu">range</span>(final_segments[, <span class="dv">1</span>]), <span class="at">yrange =</span> <span class="fu">range</span>(final_segments[, <span class="dv">2</span>]))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 8: Create the psp object using the extracted segments</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Creating psp object..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Creating psp object...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>psp_object <span class="ot">&lt;-</span> <span class="fu">psp</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x0 =</span> final_segments[, <span class="dv">1</span>],  <span class="co"># Start x-coordinates</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y0 =</span> final_segments[, <span class="dv">2</span>],  <span class="co"># Start y-coordinates</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> final_segments[, <span class="dv">3</span>],  <span class="co"># End x-coordinates</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y1 =</span> final_segments[, <span class="dv">4</span>],  <span class="co"># End y-coordinates</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">window =</span> window            <span class="co"># Define the spatial window</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"PSP object creation successful."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>PSP object creation successful.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 9: Print the summary of the created psp object</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"PSP summary..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>PSP summary...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(psp_object))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1001 line segments
Lengths:
     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
      0.0     112.0     489.9   71096.3    5342.7 1362532.9 
Total length: 71167376.3042794 units  
Length per unit area: 6.7342387556204e-05 
Angles (radians):
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.6022  1.4038  1.4411  2.3279  3.1396 
Window: rectangle = [418247.1, 1155055.8] x [774937.8, 2209230.1] units
                    (736800 x 1434000 units)
Window area = 1.0568e+12 square units</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 10: Convert the psp object to a linnet object (linear network)</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Converting psp object to linnet object..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Converting psp object to linnet object...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>linnet_object <span class="ot">&lt;-</span> <span class="fu">as.linnet</span>(psp_object)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Linnet object conversion successful."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linnet object conversion successful.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 11: Print the summary of the linnet object to check if everything is correct</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Linnet summary..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linnet summary...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(linnet_object))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear network with 5023 vertices and 9276 lines
Total length 71156180 units
Maximum vertex degree: 6
[Non-sparse matrix representation]
Network is connected
Diameter: 1466294 units
Bounding radius: 1104071 units
Numerical tolerance: 2.542313e-05 units
Enclosing window: rectangle = [418247.1, 1155055.8] x [774937.8, 2209230.1] 
units</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the linear network</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(linnet_object, <span class="at">main =</span> <span class="st">"Linear Network"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the linear network</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>accident_net <span class="ot">&lt;-</span> <span class="fu">lpp</span>(accidents_ppp_unique, linnet_object)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the road network to verify</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with custom colors and symbols</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(accident_net, </span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Accidents on Road Network in BMR"</span>,</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>,           </span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.5</span>,          </span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"black"</span>,        </span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">lty =</span> <span class="dv">1</span>,            </span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">2</span>,            </span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">col.network =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Spatial Clustering (K-Function)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply K-function to analyze clustering on the road network</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>accident_net_subset <span class="ot">&lt;-</span> accident_net[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>]  <span class="co"># Use the first 1000 points</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>K_result <span class="ot">&lt;-</span> <span class="fu">linearK</span>(accident_net_subset)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the result of the K-function</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(K_result, <span class="at">main=</span><span class="st">"K-Function Analysis of Accidents in BMR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="geovisualisation-and-geocommunication" class="level2">
<h2 class="anchored" data-anchor-id="geovisualisation-and-geocommunication">4. Geovisualisation and Geocommunication</h2>
<section id="accident-heatmap-and-road-network-overlay" class="level3">
<h3 class="anchored" data-anchor-id="accident-heatmap-and-road-network-overlay"><strong>Accident Heatmap and Road Network Overlay</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> roads, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> accidents_sf, <span class="fu">aes</span>(<span class="at">color =</span> severity), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Road Traffic Accidents in Bangkok Metropolitan Region"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatio-temporal-visualization-animation" class="level3">
<h3 class="anchored" data-anchor-id="spatio-temporal-visualization-animation">Spatio-Temporal Visualization (Animation)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an animated visualization of accidents over time (by hour)</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>accident_animation <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(accidents_sf) <span class="sc">+</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(accidents_sf)[, <span class="dv">1</span>], </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> <span class="fu">st_coordinates</span>(accidents_sf)[, <span class="dv">2</span>], <span class="at">color =</span> severity), <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_time</span>(hour) <span class="sc">+</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Accident Distribution Over Time: {frame_time}'</span>) <span class="sc">+</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the animation as a GIF</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(accident_animation, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-14-1.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<pre><code></code></pre>
</section>
<section id="space-time-k-function-analysis" class="level3">
<h3 class="anchored" data-anchor-id="space-time-k-function-analysis">Space-Time K-function Analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.geom)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat.core)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 methods overwritten by 'spatstat.core':
  method                           from            
  Ops.msr                          spatstat.model  
  affine.msr                       spatstat.model  
  AIC.dppm                         spatstat.model  
  AIC.kppm                         spatstat.model  
  AIC.mppm                         spatstat.model  
  AIC.ppm                          spatstat.model  
  anova.mppm                                       
  anova.ppm                                        
  anova.slrm                                       
  as.data.frame.bw.optim           spatstat.explore
  as.data.frame.envelope           spatstat.explore
  as.data.frame.fv                 spatstat.explore
  as.function.fv                   spatstat.explore
  as.function.leverage.ppm         spatstat.model  
  as.function.rhohat               spatstat.explore
  as.function.ssf                  spatstat.explore
  as.im.leverage.ppm               spatstat.model  
  as.im.scan.test                  spatstat.explore
  as.im.ssf                        spatstat.explore
  as.layered.msr                                   
  as.owin.dppm                     spatstat.model  
  as.owin.influence.ppm            spatstat.model  
  as.owin.kppm                     spatstat.model  
  as.owin.leverage.ppm             spatstat.model  
  as.owin.msr                      spatstat.model  
  as.owin.ppm                      spatstat.model  
  as.owin.quadrattest              spatstat.explore
  as.owin.slrm                     spatstat.model  
  as.ppp.influence.ppm             spatstat.model  
  as.ppp.ssf                       spatstat.explore
  cbind.fv                         spatstat.explore
  clusterfield.kppm                spatstat.model  
  clusterkernel.kppm               spatstat.model  
  clusterradius.kppm               spatstat.model  
  clusterradius.zclustermodel      spatstat.model  
  coef.dppm                        spatstat.model  
  coef.fii                         spatstat.model  
  coef.kppm                        spatstat.model  
  coef.mppm                        spatstat.model  
  coef.ppm                         spatstat.model  
  coef.slrm                        spatstat.model  
  coef.summary.fii                 spatstat.model  
  coef.summary.kppm                spatstat.model  
  coef.summary.ppm                 spatstat.model  
  coef.summary.slrm                spatstat.model  
  coef.vblogit                     spatstat.model  
  collapse.anylist                                 
  collapse.fv                                      
  compatible.fasp                  spatstat.explore
  compatible.fv                                    
  compatible.rat                   spatstat.explore
  contour.leverage.ppm             spatstat.model  
  contour.objsurf                  spatstat.model  
  contour.ssf                      spatstat.explore
  density.ppp                                      
  density.ppplist                  spatstat.explore
  density.psp                      spatstat.explore
  density.splitppp                 spatstat.explore
  deriv.fv                                         
  deviance.ppm                     spatstat.model  
  deviance.slrm                    spatstat.model  
  dfbetas.ppm                      spatstat.model  
  dfbetas.ppmInfluence             spatstat.model  
  dfbetas.slrm                     spatstat.model  
  dim.detpointprocfamily           spatstat.model  
  dim.fasp                         spatstat.explore
  dim.msr                          spatstat.model  
  dimnames.fasp                    spatstat.explore
  dimnames.msr                     spatstat.model  
  domain.dppm                      spatstat.model  
  domain.influence.ppm             spatstat.model  
  domain.kppm                      spatstat.model  
  domain.leverage.ppm              spatstat.model  
  domain.msr                       spatstat.model  
  domain.ppm                       spatstat.model  
  domain.quadrattest               spatstat.explore
  domain.slrm                      spatstat.model  
  extractAIC.dppm                  spatstat.model  
  extractAIC.kppm                  spatstat.model  
  extractAIC.mppm                  spatstat.model  
  extractAIC.ppm                   spatstat.model  
  extractAIC.slrm                  spatstat.model  
  family.hackglmmPQL               spatstat.model  
  family.vblogit                   spatstat.model  
  [.fasp                           spatstat.explore
  fitted.dppm                      spatstat.model  
  fitted.kppm                      spatstat.model  
  fitted.mppm                      spatstat.model  
  fitted.ppm                       spatstat.model  
  fitted.rppm                      spatstat.model  
  fitted.slrm                      spatstat.model  
  fixef.mppm                       spatstat.model  
  flipxy.msr                       spatstat.model  
  formula.dppm                     spatstat.model  
  formula.fv                       spatstat.explore
  formula.hackglmmPQL              spatstat.model  
  formula.kppm                     spatstat.model  
  formula.ppm                      spatstat.model  
  formula.slrm                     spatstat.model  
  [.fv                             spatstat.explore
  getCall.mppm                     spatstat.model  
  harmonise.fv                                     
  harmonise.msr                                    
  harmonize.fv                                     
  image.objsurf                    spatstat.model  
  image.ssf                        spatstat.explore
  [.influence.ppm                  spatstat.model  
  influence.ppm                    spatstat.model  
  influence.ppmInfluence           spatstat.model  
  influence.slrm                   spatstat.model  
  integral.influence.ppm           spatstat.model  
  integral.leverage.ppm            spatstat.model  
  integral.msr                     spatstat.model  
  integral.ssf                     spatstat.explore
  intensity.detpointprocfamily     spatstat.model  
  intensity.dppm                   spatstat.model  
  intensity.ppm                    spatstat.model  
  intensity.slrm                   spatstat.model  
  intensity.zclustermodel          spatstat.model  
  intensity.zgibbsmodel            spatstat.model  
  is.expandable.ppm                spatstat.model  
  is.marked.mppm                   spatstat.model  
  is.marked.msr                    spatstat.model  
  is.marked.ppm                    spatstat.model  
  is.marked.slrm                   spatstat.model  
  is.multitype.mppm                spatstat.model  
  is.multitype.msr                 spatstat.model  
  is.multitype.ppm                 spatstat.model  
  is.multitype.slrm                spatstat.model  
  is.poisson.exactppm              spatstat.explore
  is.poisson.interact              spatstat.model  
  is.poisson.kppm                  spatstat.model  
  is.poisson.mppm                  spatstat.model  
  is.poisson.ppm                   spatstat.model  
  is.poisson.slrm                  spatstat.model  
  is.poisson.zgibbsmodel           spatstat.model  
  is.stationary.detpointprocfamily spatstat.model  
  is.stationary.dppm               spatstat.model  
  is.stationary.exactppm           spatstat.explore
  is.stationary.kppm               spatstat.model  
  is.stationary.ppm                spatstat.model  
  is.stationary.slrm               spatstat.model  
  is.stationary.zgibbsmodel        spatstat.model  
  labels.dppm                      spatstat.model  
  labels.kppm                      spatstat.model  
  labels.ppm                       spatstat.model  
  labels.slrm                      spatstat.model  
  [.leverage.ppm                   spatstat.model  
  [.localpcfmatrix                 spatstat.explore
  logLik.dppm                      spatstat.model  
  logLik.kppm                      spatstat.model  
  logLik.mppm                      spatstat.model  
  logLik.ppm                       spatstat.model  
  logLik.slrm                      spatstat.model  
  logLik.vblogit                   spatstat.model  
  marks.ssf                        spatstat.explore
  max.ssf                          spatstat.explore
  mean.leverage.ppm                spatstat.model  
  min.ssf                          spatstat.explore
  model.frame.dppm                 spatstat.model  
  model.frame.kppm                 spatstat.model  
  model.frame.ppm                  spatstat.model  
  model.frame.slrm                 spatstat.model  
  model.matrix.dppm                spatstat.model  
  model.matrix.ippm                spatstat.model  
  model.matrix.kppm                spatstat.model  
  model.matrix.mppm                spatstat.model  
  model.matrix.ppm                 spatstat.model  
  model.matrix.slrm                spatstat.model  
  [.msr                            spatstat.model  
  nobs.dppm                        spatstat.model  
  nobs.kppm                        spatstat.model  
  nobs.mppm                        spatstat.model  
  nobs.ppm                         spatstat.model  
  pairs.im                                         
  pairs.listof                     spatstat.explore
  pairs.solist                     spatstat.explore
  persp.leverage.ppm               spatstat.model  
  persp.objsurf                    spatstat.model  
  plot.addvar                      spatstat.model  
  plot.bermantest                  spatstat.explore
  plot.bw.frac                     spatstat.explore
  plot.bw.optim                    spatstat.explore
  plot.cdftest                     spatstat.explore
  plot.diagppm                     spatstat.model  
  plot.dppm                        spatstat.model  
  plot.envelope                    spatstat.explore
  plot.fasp                        spatstat.explore
  plot.fii                         spatstat.model  
  plot.fv                                          
  plot.influence.ppm               spatstat.model  
  plot.kppm                                        
  plot.laslett                     spatstat.explore
  plot.leverage.ppm                spatstat.model  
  plot.localpcfmatrix              spatstat.explore
  plot.lurk                        spatstat.model  
  plot.minconfit                   spatstat.model  
  plot.mppm                        spatstat.model  
  plot.msr                         spatstat.model  
  plot.objsurf                     spatstat.model  
  plot.parres                      spatstat.model  
  plot.plotpairsim                 spatstat.explore
  plot.plotppm                     spatstat.model  
  plot.ppm                         spatstat.model  
  plot.profilepl                                   
  plot.qqppm                                       
  plot.quadrattest                                 
  plot.rho2hat                     spatstat.explore
  plot.rhohat                      spatstat.explore
  plot.rppm                                        
  plot.scan.test                   spatstat.explore
  plot.slrm                        spatstat.model  
  plot.spatialcdf                  spatstat.explore
  plot.ssf                         spatstat.explore
  plot.studpermutest                               
  predict.dppm                     spatstat.model  
  predict.exactppm                 spatstat.explore
  predict.kppm                     spatstat.model  
  predict.mppm                                     
  predict.ppm                                      
  predict.profilepl                spatstat.model  
  predict.rho2hat                  spatstat.explore
  predict.rhohat                                   
  predict.rppm                     spatstat.model  
  predict.slrm                     spatstat.model  
  predict.vblogit                                  
  predict.zclustermodel            spatstat.model  
  print.addvar                     spatstat.model  
  print.bt.frame                   spatstat.model  
  print.bw.frac                    spatstat.explore
  print.bw.optim                   spatstat.explore
  print.densityfun                 spatstat.explore
  print.detpointprocfamily         spatstat.model  
  print.detpointprocfamilyfun      spatstat.model  
  print.diagppm                    spatstat.model  
  print.dppm                       spatstat.model  
  print.envelope                   spatstat.explore
  print.exactppm                   spatstat.explore
  print.fasp                       spatstat.explore
  print.fii                        spatstat.model  
  print.fv                                         
  print.fvfun                      spatstat.explore
  print.hasenvelope                spatstat.explore
  print.hierarchicalordering       spatstat.model  
  print.influence.ppm              spatstat.model  
  print.interact                   spatstat.model  
  print.intermaker                 spatstat.model  
  print.isf                        spatstat.model  
  print.kppm                       spatstat.model  
  print.laslett                    spatstat.explore
  print.leverage.ppm               spatstat.model  
  print.localpcfmatrix             spatstat.explore
  print.lurk                       spatstat.model  
  print.minconfit                  spatstat.model  
  print.mppm                       spatstat.model  
  print.msr                        spatstat.model  
  print.objsurf                    spatstat.model  
  print.parres                     spatstat.model  
  print.plotpairsim                spatstat.explore
  print.plotppm                    spatstat.model  
  print.ppm                        spatstat.model  
  print.profilepl                  spatstat.model  
  print.qqppm                      spatstat.model  
  print.quadrattest                spatstat.explore
  print.rat                        spatstat.explore
  print.rho2hat                    spatstat.explore
  print.rhohat                     spatstat.explore
  print.rppm                       spatstat.model  
  print.slrm                       spatstat.model  
  print.Smoothfun                  spatstat.explore
  print.ssf                        spatstat.explore
  print.summary.dppm               spatstat.model  
  print.summary.fii                                
  print.summary.kppm               spatstat.model  
  print.summary.mppm               spatstat.model  
  print.summary.objsurf            spatstat.model  
  print.summary.ppm                spatstat.model  
  print.summary.slrm               spatstat.model  
  print.summary.ssf                spatstat.explore
  print.vblogit                    spatstat.model  
  print.zclustermodel                              
  print.zgibbsmodel                spatstat.model  
  prune.rppm                       spatstat.model  
  quantile.density                                 
  ranef.mppm                       spatstat.model  
  range.ssf                        spatstat.explore
  [.rat                            spatstat.explore
  reach.detpointprocfamily         spatstat.model  
  reach.dppm                       spatstat.model  
  reach.fii                        spatstat.model  
  reach.interact                   spatstat.model  
  reach.kppm                       spatstat.model  
  reach.ppm                        spatstat.model  
  reach.slrm                       spatstat.model  
  reach.zclustermodel              spatstat.model  
  rescale.msr                      spatstat.model  
  residuals.dppm                   spatstat.model  
  residuals.kppm                   spatstat.model  
  residuals.mppm                   spatstat.model  
  residuals.ppm                    spatstat.model  
  residuals.slrm                   spatstat.model  
  rmhmodel.ppm                     spatstat.model  
  rmh.ppm                          spatstat.model  
  rotate.msr                       spatstat.model  
  scalardilate.msr                 spatstat.model  
  shift.influence.ppm              spatstat.model  
  shift.leverage.ppm               spatstat.model  
  shift.msr                        spatstat.model  
  shift.quadrattest                spatstat.explore
  simulate.detpointprocfamily      spatstat.model  
  simulate.dppm                    spatstat.model  
  simulate.kppm                    spatstat.model  
  simulate.mppm                    spatstat.model  
  simulate.ppm                     spatstat.model  
  simulate.profilepl               spatstat.model  
  simulate.rhohat                  spatstat.explore
  simulate.slrm                    spatstat.model  
  split.msr                        spatstat.model  
  [.ssf                            spatstat.explore
  summary.dppm                     spatstat.model  
  summary.envelope                 spatstat.explore
  summary.fii                      spatstat.model  
  summary.kppm                     spatstat.model  
  summary.mppm                     spatstat.model  
  summary.msr                      spatstat.model  
  summary.objsurf                  spatstat.model  
  summary.ppm                                      
  summary.profilepl                spatstat.model  
  summary.slrm                     spatstat.model  
  summary.ssf                      spatstat.explore
  summary.vblogit                  spatstat.model  
  terms.dppm                       spatstat.model  
  terms.kppm                       spatstat.model  
  terms.mppm                       spatstat.model  
  terms.ppm                        spatstat.model  
  terms.slrm                       spatstat.model  
  unitname.dppm                    spatstat.model  
  unitname.kppm                    spatstat.model  
  unitname.minconfit               spatstat.model  
  unitname.msr                     spatstat.model  
  unitname.ppm                     spatstat.model  
  unitname.slrm                    spatstat.model  
  unmark.ssf                       spatstat.explore
  unstack.msr                      spatstat.model  
  update.detpointprocfamily        spatstat.model  
  update.interact                  spatstat.model  
  update.ippm                                      
  update.kppm                      spatstat.model  
  update.msr                       spatstat.model  
  update.ppm                                       
  update.slrm                      spatstat.model  
  vcov.kppm                        spatstat.model  
  vcov.mppm                                        
  vcov.ppm                                         
  vcov.slrm                        spatstat.model  
  Window.dppm                      spatstat.model  
  Window.influence.ppm             spatstat.model  
  Window.kppm                      spatstat.model  
  Window.leverage.ppm              spatstat.model  
  Window.msr                       spatstat.model  
  Window.ppm                       spatstat.model  
  Window.quadrattest               spatstat.explore
  Window.slrm                      spatstat.model  
  with.fv                          spatstat.explore
  with.msr                         spatstat.model  
  with.ssf                         spatstat.explore
  $&lt;-.fv                           spatstat.explore
  coef&lt;-.fii                       spatstat.model  
  dimnames&lt;-.fasp                  spatstat.explore
  [&lt;-.fv                           spatstat.explore
  marks&lt;-.ssf                      spatstat.explore
  names&lt;-.fv                       spatstat.explore
  unitname&lt;-.dppm                  spatstat.model  
  unitname&lt;-.kppm                  spatstat.model  
  unitname&lt;-.minconfit             spatstat.model  
  unitname&lt;-.msr                   spatstat.model  
  unitname&lt;-.ppm                   spatstat.model  
  unitname&lt;-.slrm                  spatstat.model  </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.core 2.4-4.010</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'spatstat.core'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:lattice':

    panel.histogram</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:spatstat.model':

    [.influence.ppm, [.leverage.ppm, [.msr, accumulateStatus,
    active.interactions, adaptcoef, addvar, affine.msr, AIC.dppm,
    AIC.kppm, AIC.mppm, AIC.ppm, anova.mppm, anova.ppm, anova.slrm,
    areadelta2, AreaInter, as.function.leverage.ppm, as.fv.dppm,
    as.fv.kppm, as.fv.minconfit, as.im.leverage.ppm, as.interact,
    as.interact.fii, as.interact.interact, as.interact.ppm,
    as.interact.zgibbsmodel, as.isf, as.isf.zgibbsmodel,
    as.layered.msr, as.owin.dppm, as.owin.influence.ppm, as.owin.kppm,
    as.owin.leverage.ppm, as.owin.msr, as.owin.ppm, as.owin.slrm,
    as.ppm, as.ppm.dppm, as.ppm.kppm, as.ppm.ppm, as.ppm.profilepl,
    as.ppm.rppm, as.ppp.influence.ppm, auc.kppm, auc.ppm, auc.slrm,
    augment.msr, BadGey, bc, bc.ppm, berman.test.ppm, bigvaluerule,
    blankcoefnames, bt.frame, cannot.update, cauchy.estK,
    cauchy.estpcf, cdf.test.mppm, cdf.test.ppm, cdf.test.slrm,
    check.separable, closepaircounts, clusterfield.kppm, clusterfit,
    clusterkernel.kppm, clusterradius.kppm,
    clusterradius.zclustermodel, coef.dppm, coef.fii, coef.kppm,
    coef.mppm, coef.ppm, coef.slrm, coef.summary.fii,
    coef.summary.kppm, coef.summary.ppm, coef.summary.slrm,
    coef.vblogit, coef&lt;-.fii, compareFit, Concom, condSimCox,
    contour.leverage.ppm, contour.objsurf, crosspaircounts,
    damaged.ppm, data.mppm, data.ppm, deltasuffstat,
    detpointprocfamilyfun, deviance.ppm, deviance.slrm, dfbetas.ppm,
    dfbetas.ppmInfluence, dfbetas.slrm, dffit, dffit.ppm, dffit.slrm,
    diagnose.ppm, diagnose.ppm.engine, DiggleGatesStibbard,
    DiggleGratton, dim.detpointprocfamily, dim.msr, dimnames.msr,
    domain.dppm, domain.influence.ppm, domain.kppm,
    domain.leverage.ppm, domain.msr, domain.ppm, domain.slrm,
    doMultiStraussHard, dppapproxkernel, dppapproxpcf, dppBessel,
    dppCauchy, dppDpcf, dppeigen, dppGauss, dppkernel, dppm, dppMatern,
    dppmFixAlgorithm, dppmFixIntensity, dppparbounds, dppPowerExp,
    DPPSaddle, DPPSaddlePairwise, dppspecden, dppspecdenrange, dummify,
    dummy.ppm, eem, eem.ppm, eem.slrm, effectfun, emend, emend.ppm,
    emend.slrm, envelope.kppm, envelope.ppm, envelope.slrm, equalpairs,
    evalInteraction, evalInterEngine, evalPairPotential,
    evalPairwiseTerm, exactMPLEstrauss, expandDot, extractAIC.dppm,
    extractAIC.kppm, extractAIC.mppm, extractAIC.ppm, extractAIC.slrm,
    fakefii, family.hackglmmPQL, family.vblogit, fii, Fiksel,
    fill.coefs, findCovariate, fitin, fitin.ppm, fitin.profilepl,
    fitted.dppm, fitted.kppm, fitted.mppm, fitted.ppm, fitted.rppm,
    fitted.slrm, fixef.mppm, flipxy.msr, forbid.logi, formula.dppm,
    formula.hackglmmPQL, formula.kppm, formula.ppm, formula.slrm, Gcom,
    getCall.mppm, getdataname, getglmdata, getglmfit, getglmsubset,
    getppmdatasubset, getppmOriginalCovariates, Geyer, geyercounts,
    geyerdelta2, GLMpredict, Gres, hackglmmPQL, Hardcore, hardcoredist,
    hardcoredist.fii, hardcoredist.ppm, harmonic, harmonise.msr,
    has.offset, has.offset.term, hasglmfit, hierarchicalordering,
    HierHard, hiermat, hierpair.family, HierStrauss, HierStraussHard,
    ho.engine, Hybrid, hybrid.family, ic, ic.kppm, ic.ppm,
    illegal.iformula, image.objsurf, impliedcoefficients,
    impliedpresence, improve.kppm, influence.ppm,
    influence.ppmInfluence, influence.slrm, inforder.family,
    instantiate.interact, integral.influence.ppm,
    integral.leverage.ppm, integral.msr, intensity.detpointprocfamily,
    intensity.dppm, intensity.ppm, intensity.slrm,
    intensity.zclustermodel, intensity.zgibbsmodel,
    interactionfamilyname, interactionorder, interactionorder.fii,
    interactionorder.interact, interactionorder.isf,
    interactionorder.ppm, interactionorder.zgibbsmodel, intermaker,
    ippm, is.dppm, is.expandable.ppm, is.hybrid, is.hybrid.interact,
    is.hybrid.ppm, is.interact, is.kppm, is.lppm, is.marked.mppm,
    is.marked.msr, is.marked.ppm, is.marked.slrm, is.mppm,
    is.multitype.mppm, is.multitype.msr, is.multitype.ppm,
    is.multitype.slrm, is.poisson.interact, is.poisson.kppm,
    is.poisson.mppm, is.poisson.ppm, is.poisson.slrm,
    is.poisson.zgibbsmodel, is.ppm, is.slrm,
    is.stationary.detpointprocfamily, is.stationary.dppm,
    is.stationary.kppm, is.stationary.ppm, is.stationary.slrm,
    is.stationary.zgibbsmodel, Kcom, killinteraction, Kmodel,
    Kmodel.detpointprocfamily, Kmodel.dppm, Kmodel.kppm, Kmodel.ppm,
    Kmodel.slrm, Kmodel.zclustermodel, Kpcf.kppm, kppm, kppm.formula,
    kppm.ppp, kppm.quad, kppmCLadap, kppmComLik, kppmMinCon,
    kppmPalmLik, Kres, labels.dppm, labels.kppm, labels.ppm,
    labels.slrm, LambertW, LennardJones, leverage, leverage.ppm,
    leverage.ppmInfluence, leverage.slrm, lgcp.estK, lgcp.estpcf,
    logi.engine, logLik.dppm, logLik.kppm, logLik.mppm, logLik.ppm,
    logLik.slrm, logLik.vblogit, LurkEngine, lurking, lurking.mppm,
    lurking.ppm, lurking.ppp, mapInterVars, matclust.estK,
    matclust.estpcf, Mayer, mean.leverage.ppm, measureContinuous,
    measureDiscrete, measureNegative, measurePositive,
    measureVariation, mincontrast, model.covariates, model.depends,
    model.frame.dppm, model.frame.kppm, model.frame.ppm,
    model.frame.slrm, model.images, model.images.dppm,
    model.images.kppm, model.images.ppm, model.images.slrm,
    model.is.additive, model.matrix.dppm, model.matrix.ippm,
    model.matrix.kppm, model.matrix.mppm, model.matrix.ppm,
    model.matrix.slrm, model.se.image, modelFrameGam, mpl.engine,
    mpl.get.covariates, mpl.prepare, mpl.usable, mppm, msr, MultiHard,
    MultiStrauss, MultiStraussHard, newformula,
    newstyle.coeff.handling, nndcumfun, no.trend.ppm, nobs.dppm,
    nobs.kppm, nobs.mppm, nobs.ppm, npfun, objsurf, objsurf.dppm,
    objsurf.kppm, objsurf.minconfit, objsurfEngine, Ops.msr,
    optimConverged, optimNsteps, optimStatus, Ord, ord.family,
    OrdThresh, outdated.interact, oversize.quad, PairPiece,
    PairPotentialType, pairsat.family, Pairwise, pairwise.family,
    panel.contour, panel.histogram, panel.image, parameters,
    parameters.dppm, parameters.fii, parameters.interact,
    parameters.kppm, parameters.ppm, parameters.profilepl,
    parameters.slrm, parres, partialModelMatrix, pcfmodel,
    pcfmodel.detpointprocfamily, pcfmodel.dppm, pcfmodel.kppm,
    pcfmodel.ppm, pcfmodel.slrm, pcfmodel.zclustermodel, Penttinen,
    persp.leverage.ppm, persp.objsurf, plot.addvar, plot.diagppm,
    plot.dppm, plot.fii, plot.influence.ppm, plot.kppm,
    plot.leverage.ppm, plot.lurk, plot.minconfit, plot.mppm, plot.msr,
    plot.objsurf, plot.parres, plot.plotppm, plot.ppm, plot.profilepl,
    plot.qqppm, plot.rppm, plot.slrm, ploterodeimage, ploterodewin,
    PoisSaddle, PoisSaddleArea, PoisSaddleGeyer, PoisSaddlePairwise,
    Poisson, polynom, ppm, ppm.default, ppm.formula, ppm.ppp, ppm.quad,
    ppmCovariates, ppmDerivatives, ppmInfluence, ppmInfluenceEngine,
    PPMmodelmatrix, predict.dppm, predict.kppm, predict.mppm,
    predict.ppm, predict.profilepl, predict.rppm, predict.slrm,
    predict.vblogit, predict.zclustermodel, print.addvar,
    print.bt.frame, print.detpointprocfamily,
    print.detpointprocfamilyfun, print.diagppm, print.dppm, print.fii,
    print.hierarchicalordering, print.influence.ppm, print.interact,
    print.intermaker, print.isf, print.kppm, print.leverage.ppm,
    print.lurk, print.minconfit, print.mppm, print.msr, print.objsurf,
    print.parres, print.plotppm, print.ppm, print.profilepl,
    print.qqppm, print.rppm, print.slrm, print.summary.dppm,
    print.summary.fii, print.summary.kppm, print.summary.mppm,
    print.summary.objsurf, print.summary.ppm, print.summary.slrm,
    print.vblogit, print.zclustermodel, print.zgibbsmodel, printStatus,
    printStatusList, profilepl, project.ppm, prune.rppm, pseudoR2,
    pseudoR2.ppm, pseudoR2.slrm, psib, psib.kppm, psst, psstA, psstG,
    qqplot.ppm, quad.mppm, quad.ppm, quadBlockSizes, quadrat.test.mppm,
    quadrat.test.ppm, quadrat.test.slrm, ranef.mppm, rdpp,
    reach.detpointprocfamily, reach.dppm, reach.fii, reach.interact,
    reach.kppm, reach.ppm, reach.slrm, reach.zclustermodel,
    reduceformula, reincarnate.interact, relrisk.ppm, repul,
    repul.dppm, rescale.msr, resid1panel, resid1plot, resid4plot,
    residuals.dppm, residuals.kppm, residuals.mppm, residuals.ppm,
    residuals.slrm, response, response.dppm, response.glm,
    response.kppm, response.lm, response.mppm, response.ppm,
    response.slrm, rex, rhohat.ppm, rhohat.slrm, rmh.ppm, rmhmodel.ppm,
    roc.kppm, roc.ppm, roc.slrm, rotate.msr, rppm, SaddleApprox,
    safeFiniteValue, safePositiveValue, SatPiece, Saturated,
    scalardilate.msr, shift.influence.ppm, shift.leverage.ppm,
    shift.msr, signalStatus, simulate.detpointprocfamily,
    simulate.dppm, simulate.kppm, simulate.mppm, simulate.ppm,
    simulate.profilepl, simulate.slrm, slr.prepare,
    slrAssemblePixelData, slrm, slrmInfluence, Smooth.influence.ppm,
    Smooth.leverage.ppm, Smooth.msr, Softcore, sp.foundclass,
    sp.foundclasses, spatialCovariateEvidence.ppm,
    spatialCovariateEvidence.slrm, spatstatDPPModelInfo, split.msr,
    splitHybridInteraction, Strauss, strausscounts, StraussHard,
    stripGLMM, subfits, subfits.new, subfits.old, suffloc, suffstat,
    suffstat.generic, suffstat.poisson, summary.dppm, summary.fii,
    summary.kppm, summary.mppm, summary.msr, summary.objsurf,
    summary.ppm, summary.profilepl, summary.slrm, summary.vblogit,
    terms.dppm, terms.kppm, terms.mppm, terms.ppm, terms.slrm,
    thomas.estK, thomas.estpcf, totalVariation, triplet.family,
    Triplets, tweak.coefs, unitname.dppm, unitname.kppm,
    unitname.minconfit, unitname.msr, unitname.ppm, unitname.slrm,
    unitname&lt;-.dppm, unitname&lt;-.kppm, unitname&lt;-.minconfit,
    unitname&lt;-.msr, unitname&lt;-.ppm, unitname&lt;-.slrm, unstack.msr,
    update.detpointprocfamily, update.interact, update.ippm,
    update.kppm, update.msr, update.ppm, update.slrm, valid,
    valid.detpointprocfamily, valid.ppm, valid.slrm, varcount,
    varcountEngine, vargamma.estK, vargamma.estpcf, vcov.kppm,
    vcov.mppm, vcov.ppm, vcov.slrm, versionstring.interact,
    versionstring.ppm, Window.dppm, Window.influence.ppm, Window.kppm,
    Window.leverage.ppm, Window.msr, Window.ppm, Window.slrm,
    windows.mppm, with.msr, zclustermodel, zgibbsmodel</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:spatstat.explore':

    [.fasp, [.fv, [.localpcfmatrix, [.rat, [.ssf, [&lt;-.fv, $&lt;-.fv,
    adaptive.density, adjust.ratfv, allstats, alltypes, ang2rad,
    apply.ssf, as.data.frame.bw.optim, as.data.frame.envelope,
    as.data.frame.fv, as.function.fv, as.function.rhohat,
    as.function.ssf, as.fv, as.fv.bw.optim, as.fv.data.frame,
    as.fv.fasp, as.fv.fv, as.fv.matrix, as.im.scan.test, as.im.ssf,
    as.owin.quadrattest, as.ppp.ssf, assemble.plot.objects, auc,
    auc.ppp, bandwidth.is.infinite, BartCalc, berman.test,
    berman.test.ppp, bermantestCalc, bermantestEngine, bind.fv,
    bind.ratfv, bits.envelope, bits.test, blur, bw.CvL, bw.CvLHeat,
    bw.diggle, bw.frac, bw.optim, bw.pcf, bw.ppl, bw.pplHeat,
    bw.relrisk, bw.scott, bw.scott.iso, bw.smoothppp, bw.stoyan,
    calc.DR, calc.NNIR, calc.SAVE, calc.SIR, calc.TSE, cbind.fv,
    cdf.test, cdf.test.ppp, censtimeCDFest, check.testfun, circdensity,
    circticks, clarkevans, clarkevans.test, clarkevansCalc, clusterset,
    collapse.anylist, collapse.fv, compatible.fasp, compatible.fv,
    compatible.rat, compileCDF, compileK, compilepcf, conform.ratfv,
    contour.ssf, cor.im, cov.im, CressieReadName, CressieReadStatistic,
    CressieReadSymbol, cutoff2Dkernel, CVforPCF, dclf.progress,
    dclf.sigtrace, dclf.test, density.ppp, density.ppplist,
    density.psp, density.splitppp, densityAdaptiveKernel.ppp,
    densitycrossEngine, densityfun, densityfun.ppp, densityHeat,
    densityHeat.ppp, densitypointsEngine, densityVoronoi,
    densityVoronoi.ppp, deriv.fv, Deviation, dg.envelope, dg.progress,
    dg.sigtrace, dg.test, digestCovariates, digital.volume, dim.fasp,
    dimhat, dimnames.fasp, dimnames&lt;-.fasp, distcdf, distributecbind,
    domain.quadrattest, edge.Ripley, edge.Trans, Emark, envelope,
    envelope.envelope, envelope.hasenvelope, envelope.matrix,
    envelope.pp3, envelope.ppp, envelopeArray, envelopeEngine,
    envelopeProgressData, envelopeTest, eval.fasp, eval.fv, evalCovar,
    evaluate2Dkernel, evaluateCovariate, evaluateCovariateAtPixels,
    evaluateCovariateAtPoints, exactppm, ExpSmoothLog,
    extractAtomicQtests, f3Cengine, f3engine, F3est, fasp, Fest,
    Fhazard, findbestlegendpos, findcbind, Finhom, flatfname,
    FmultiInhom, FormatFaspFormulae, formula.fv, formula&lt;-,
    formula&lt;-.fv, fryplot, frypoints, fv, fvexprmap, fvlabelmap,
    fvlabels, fvlabels&lt;-, fvlegend, fvnames, fvnames&lt;-, g3Cengine,
    g3engine, G3est, Gcross, Gdot, Gest, getSumFun, Gfox, Ginhom,
    Gmulti, GmultiInhom, good.correction.K, harmonise.fv, harmonize.fv,
    hasenvelope, Hest, hopskel, hopskel.test, hotbox, idw, Iest,
    image.ssf, implemented.for.K, increment.fv, integral.ssf,
    is.atomicQtest, is.poisson.exactppm, is.scov,
    is.stationary.exactppm, Jcross, Jdot, Jest, Jfox, Jinhom, Jmulti,
    k3engine, K3est, Kborder.engine, Kcross, Kcross.inhom, Kdot,
    Kdot.inhom, Kest, Kest.fft, Kinhom, Kmark, Kmeasure, Kmulti,
    Kmulti.inhom, Knone.engine, Kount, Krect.engine, Kscaled, Ksector,
    Kwtsum, laslett, Lcross, Lcross.inhom, Ldot, Ldot.inhom, Lest,
    Linhom, localK, localKcross, localKcross.inhom, localKdot,
    localKengine, localKinhom, localKmultiEngine, localL, localLcross,
    localLcross.inhom, localLdot, localLinhom, localpcf,
    localpcfengine, localpcfinhom, localpcfmatrix, lohboot,
    lookup2DkernelInfo, Lscaled, mad.progress, mad.sigtrace, mad.test,
    makefvlabel, markconnect, markcorr, markcorrint, markcrosscorr,
    markmarkscatter, markmean, marks.ssf, marks&lt;-.ssf, marktable,
    markvar, markvario, maskLaslett, match2DkernelName, max.ssf,
    mctest.progress, mctest.sigtrace, mctestSigtraceEngine, meanlistfv,
    min.ssf, miplot, names&lt;-.fv, nearest.neighbour, nnclean,
    nnclean.pp3, nnclean.ppp, nncleanEngine, nncorr, nndensity,
    nndensity.ppp, nnmean, nnorient, nnvario, pairMean, pairorient,
    pairs.im, pairs.listof, pairs.solist, panel.contour,
    panel.histogram, panel.image, pcf, pcf.fasp, pcf.fv, pcf.ppp,
    pcf3engine, pcf3est, pcfcross, pcfcross.inhom, pcfdot,
    pcfdot.inhom, pcfinhom, pcfmulti, pcfmulti.inhom, plot.bermantest,
    plot.bw.frac, plot.bw.optim, plot.cdftest, plot.envelope,
    plot.fasp, plot.fv, plot.laslett, plot.localpcfmatrix,
    plot.plotpairsim, plot.quadrattest, plot.rho2hat, plot.rhohat,
    plot.scan.test, plot.spatialcdf, plot.ssf, plot.studpermutest,
    polyLaslett, pool, pool.anylist, pool.envelope, pool.fasp, pool.fv,
    pool.quadrattest, pool.rat, PPversion, predict.exactppm,
    predict.rho2hat, predict.rhohat, prefixfv, print.bw.frac,
    print.bw.optim, print.densityfun, print.envelope, print.exactppm,
    print.fasp, print.fv, print.fvfun, print.hasenvelope,
    print.laslett, print.localpcfmatrix, print.plotpairsim,
    print.quadrattest, print.rat, print.rho2hat, print.rhohat,
    print.Smoothfun, print.ssf, print.summary.ssf, QQversion,
    quadrat.test, quadrat.test.ppp, quadrat.test.quadratcount,
    quadrat.test.splitppp, quadrat.testEngine, range.ssf, rat, ratfv,
    rebadge.as.crossfun, rebadge.as.dotfun, rebadge.fv, rebadgeLabels,
    reconcile.fv, rectcontact, RelevantDeviation, reload.or.compute,
    relrisk, relrisk.ppp, rename.fv, resolve.2D.kernel,
    resolve.foxall.window, resolve.lambda, resolve.reciplambda,
    resolveEinfo, rho2hat, rhohat, rhohat.ppp, rhohat.quad, rhohatCalc,
    rhohatEngine, rmax.Rigid, rmax.Ripley, rmax.rule, rmax.Trans, roc,
    roc.ppp, rocData, rocModel, rose, rose.default, rose.density,
    rose.fv, rose.histogram, roseContinuous, rotmean, scan.test,
    scanBinomLRTS, scanLRTS, scanmeasure, scanmeasure.im,
    scanmeasure.ppp, scanPoisLRTS, sdr, sdr.ppp, sdrPredict,
    second.moment.calc, second.moment.engine, segregation.test,
    segregation.test.ppp, sewpcf, sewsmod, sharpen, sharpen.ppp,
    shift.quadrattest, simulate.rhohat, simulrecipe, Smooth, Smooth.fv,
    Smooth.im, Smooth.ppp, Smooth.solist, Smooth.ssf,
    smoothcrossEngine, Smoothfun, Smoothfun.ppp, smoothpointsEngine,
    spatcov, spatialcdf, spatialCDFframe, spatialCDFtest,
    spatialCDFtestCalc, spatialCovariateEvidence,
    spatialCovariateEvidence.exactppm, spatialCovariateEvidence.ppp,
    sphere.volume, ssf, stienen, stienenSet, studpermu.test,
    subspaceDistance, summary.envelope, summary.ssf, thresholdCI,
    thresholdSelect, transect.im, Tstat, tweak.fv.entry,
    tweak.ratfv.entry, twostage.envelope, twostage.test, unmark.ssf,
    validate.angles, validate.weights, validate2Dkernel, vanilla.fv,
    varblock, Vmark, weightedclosepairs, which.max.im,
    Window.quadrattest, with.fv, with.ssf, X2testEngine</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:spatstat.univar':

    bw.abram, CDF, CDF.density, densityAdaptiveKernel, dkernel,
    kaplan.meier, kernel.factor, kernel.moment, kernel.squint, km.rs,
    km.rs.opt, match.kernel, pkernel, qkernel, quantile.density,
    reduced.sample, rkernel, stieltjes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming accidents_sf is your accident data</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject accidents_sf to UTM Zone 47N (EPSG: 32647)</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>accidents_projected <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(accidents_sf, <span class="at">crs =</span> <span class="dv">32647</span>)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'incident_datetime' to numeric time (hours since start of study)</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>accidents_projected<span class="sc">$</span>incident_time_numeric <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  accidents_projected<span class="sc">$</span>incident_datetime, <span class="fu">min</span>(accidents_projected<span class="sc">$</span>incident_datetime), <span class="at">units =</span> <span class="st">"hours"</span>))</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract spatial coordinates from accidents_sf</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(accidents_projected)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a spatstat window (bounding box) from the reprojected coordinates</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>window <span class="ot">&lt;-</span> <span class="fu">owin</span>(<span class="at">xrange =</span> <span class="fu">range</span>(coords[, <span class="dv">1</span>]), <span class="at">yrange =</span> <span class="fu">range</span>(coords[, <span class="dv">2</span>]))</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data to ppp format (spatstat point pattern object)</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>accidents_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> coords[, <span class="dv">1</span>], <span class="at">y =</span> coords[, <span class="dv">2</span>], <span class="at">window =</span> window)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign temporal marks (time in hours)</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">marks</span>(accidents_ppp) <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> accidents_projected<span class="sc">$</span>incident_time_numeric)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the space-time K-function</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>Kst <span class="ot">&lt;-</span> <span class="fu">Kest</span>(accidents_ppp, <span class="at">correction =</span> <span class="st">"Ripley"</span>)</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Space-Time K-function result</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Kst, <span class="at">main =</span> <span class="st">"Space-Time K-function for Road Accidents"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bonus-predictive-modeling-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="bonus-predictive-modeling-machine-learning">5. Bonus: Predictive Modeling (Machine Learning)</h2>
<section id="feature-preparation-for-machine-learning" class="level3">
<h3 class="anchored" data-anchor-id="feature-preparation-for-machine-learning">Feature Preparation for Machine Learning</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the geometry column by converting the sf object to a regular data frame</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>accidents_ml <span class="ot">&lt;-</span> accidents_sf <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(severity, hour, day_of_week, season) <span class="sc">%&gt;%</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)  </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert factors to numeric for ML purposes</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>accidents_ml<span class="sc">$</span>day_of_week <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(accidents_ml<span class="sc">$</span>day_of_week))</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>accidents_ml<span class="sc">$</span>season <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(accidents_ml<span class="sc">$</span>season))</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(accidents_ml)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [12,986 × 4] (S3: tbl_df/tbl/data.frame)
 $ severity   : chr [1:12986] "Medium" "Medium" "Low" "Medium" ...
 $ hour       : int [1:12986] 2 3 3 3 4 4 5 5 5 6 ...
 $ day_of_week: num [1:12986] 3 3 3 3 3 3 3 3 3 3 ...
 $ season     : num [1:12986] 4 4 4 4 4 4 4 4 4 4 ...</code></pre>
</div>
</div>
</section>
<section id="random-forest-model" class="level3">
<h3 class="anchored" data-anchor-id="random-forest-model">Random Forest Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train a basic Random Forest to predict accident severity based on time and seasonal features</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">train</span>(severity <span class="sc">~</span> ., <span class="at">data =</span> accidents_ml, <span class="at">method =</span> <span class="st">"rf"</span>, <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>note: only 2 unique complexity parameters in default grid. Truncating the grid to 2 .</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check model performance</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>rf_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

12986 samples
    3 predictor
    3 classes: 'High', 'Low', 'Medium' 

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 10389, 10388, 10389, 10389, 10389 
Resampling results across tuning parameters:

  mtry  Accuracy   Kappa     
  2     0.5766975  0.06664339
  3     0.5638371  0.06716721

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was mtry = 2.</code></pre>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>